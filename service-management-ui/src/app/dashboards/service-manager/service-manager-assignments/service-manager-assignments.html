<h2 class="page-title">ğŸ§‘â€ğŸ”§ Assign Technicians</h2>

<div class="card-grid">

  <mat-card
    *ngFor="let r of requests"
    class="assign-card">

    <div class="header">
      <h3>{{ r.serviceName }}</h3>
      <span class="badge">Pending</span>
    </div>

    <p><b>Category:</b> {{ r.serviceCategory }}</p>
    <p><b>Customer:</b> {{ r.customerName }}</p>
    <p><b>Requested On:</b> {{ r.requestedDate }}</p>

    <!-- ISSUE DESCRIPTION -->
    <div class="issue-box">
      <b>Issue</b>
      <p>{{ r.issueDescription }}</p>
    </div>

    <!-- SAFE FORM -->
    <form
      *ngIf="forms.has(r.serviceRequestId)"
      [formGroup]="forms.get(r.serviceRequestId)!">

      <mat-form-field appearance="outline" class="full">
        <mat-label>Schedule Date</mat-label>
        <input
          matInput
          [matDatepicker]="picker"
          formControlName="scheduledDate">
        <mat-datepicker-toggle
          matSuffix
          [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full">
        <mat-label>Technician</mat-label>
        <mat-select formControlName="technicianId">
          <mat-option
            *ngFor="let t of technicians"
            [value]="t.technicianId">
            {{ t.technicianName }} ({{ t.activeTasks }})
          </mat-option>
        </mat-select>
      </mat-form-field>

      <button
        mat-raised-button
        color="primary"
        class="assign-btn"
        (click)="assign(r.serviceRequestId)">
        Assign
      </button>

    </form>

  </mat-card>

</div>

<!-- EMPTY STATE -->
<p *ngIf="!requests.length" class="empty">
  ğŸ‰ No pending requests to assign
</p>
