<h2 class="page-title">
  <span class="material-icons">assignment</span>
  My Assigned Requests
</h2>

<!-- FILTER BAR -->
<div class="filter-bar">

  <select [(ngModel)]="statusFilter" (change)="applyFilters()">
    <option value="">All Statuses</option>
    <option value="Assigned">Assigned</option>
    <option value="In-Progress">In-Progress</option>
    <option value="Completed">Completed</option>
    <option value="Closed">Closed</option>
  </select>

  <input
    type="text"
    placeholder="Search by customer or service"
    [(ngModel)]="searchText"
    (input)="applyFilters()"
  />

</div>

<!-- TABLE -->
<table mat-table [dataSource]="pagedData" class="modern-table">

  <ng-container matColumnDef="id">
    <th mat-header-cell *matHeaderCellDef>ID</th>
    <td mat-cell *matCellDef="let r">{{ r.serviceRequestId }}</td>
  </ng-container>

  <ng-container matColumnDef="service">
    <th mat-header-cell *matHeaderCellDef>Service</th>
    <td mat-cell *matCellDef="let r">{{ r.serviceName }}</td>
  </ng-container>

  <ng-container matColumnDef="category">
    <th mat-header-cell *matHeaderCellDef>Category</th>
    <td mat-cell *matCellDef="let r">{{ r.serviceCategory }}</td>
  </ng-container>

  <ng-container matColumnDef="customer">
    <th mat-header-cell *matHeaderCellDef>Customer</th>
    <td mat-cell *matCellDef="let r">{{ r.customerName }}</td>
  </ng-container>

  <ng-container matColumnDef="date">
    <th mat-header-cell *matHeaderCellDef>Scheduled</th>
    <td mat-cell *matCellDef="let r">{{ r.scheduledDate }}</td>
  </ng-container>

  <ng-container matColumnDef="status">
    <th mat-header-cell *matHeaderCellDef>Status</th>
    <td mat-cell *matCellDef="let r">
      <span class="status-pill {{ r.status | lowercase }}">
        {{ r.status }}
      </span>
    </td>
  </ng-container>

  <ng-container matColumnDef="updateStatus">
    <th mat-header-cell *matHeaderCellDef>Update</th>
    <td mat-cell *matCellDef="let r">

      <mat-radio-group [value]="r.status">

        <mat-radio-button
          value="In-Progress"
          [disabled]="r.status !== 'Assigned'"
          (change)="updateStatus(r, 'In-Progress')">
          In-Progress
        </mat-radio-button>

        <mat-radio-button
          value="Completed"
          [disabled]="r.status !== 'In-Progress'"
          (change)="updateStatus(r, 'Completed')">
          Completed
        </mat-radio-button>

      </mat-radio-group>

    </td>
  </ng-container>

  <ng-container matColumnDef="completedDate">
    <th mat-header-cell *matHeaderCellDef>Completed On</th>
    <td mat-cell *matCellDef="let r">
      {{ r.status === 'Completed' || r.status === 'Closed'
        ? r.completedDate
        : '-' }}
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
  <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

</table>

<!-- PAGINATOR -->
<mat-paginator
  [length]="filteredData.length"
  [pageSize]="pageSize"
  [pageSizeOptions]="[5,10,20]"
  (page)="onPageChange($event)">
</mat-paginator>

<!-- EMPTY -->
<div *ngIf="!filteredData.length" class="empty-state">
  <span class="material-icons">task_alt</span>
  <p>No assigned requests found</p>
</div>
